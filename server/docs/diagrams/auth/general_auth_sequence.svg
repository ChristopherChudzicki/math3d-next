<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="604px" preserveAspectRatio="none" style="width:632px;height:604px;background:#FFFFFF;" version="1.1" viewBox="0 0 632 604" width="632px" zoomAndPan="magnify"><defs><filter height="300%" id="fz2z209l9w0uu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fz2z209l9w0uu)" height="282.6602" style="stroke:#000000;stroke-width:2.0;" width="329.5" x="10" y="261.6621"/><rect fill="#FFFFFF" height="59.5762" style="stroke:none;stroke-width:1.0;" width="329.5" x="10" y="308.2832"/><rect fill="#FFFFFF" height="44.2656" style="stroke:none;stroke-width:1.0;" width="329.5" x="10" y="367.8594"/><rect fill="#FFFFFF" height="132.1973" style="stroke:none;stroke-width:1.0;" width="329.5" x="10" y="412.125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="49" x2="49" y1="40.4883" y2="561.3223"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="298.5" x2="298.5" y1="40.4883" y2="561.3223"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="572" x2="572" y1="40.4883" y2="561.3223"/><rect fill="#FEFECE" filter="url(#fz2z209l9w0uu)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="27" y="25.5352">Client</text><rect fill="#FEFECE" filter="url(#fz2z209l9w0uu)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="20" y="560.3223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="27" y="580.8574">Client</text><rect fill="#FEFECE" filter="url(#fz2z209l9w0uu)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="268.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="275.5" y="25.5352">Server</text><rect fill="#FEFECE" filter="url(#fz2z209l9w0uu)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="268.5" y="560.3223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="275.5" y="580.8574">Server</text><rect fill="#FEFECE" filter="url(#fz2z209l9w0uu)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="96" x="522" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="529" y="25.5352">User's Email</text><rect fill="#FEFECE" filter="url(#fz2z209l9w0uu)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="96" x="522" y="560.3223"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="529" y="580.8574">User's Email</text><polygon fill="#A80036" points="287,67.7988,297,71.7988,287,75.7988,291,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="293" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="56" y="67.0566">GET /user/login</text><polygon fill="#A80036" points="560,97.1094,570,101.1094,560,105.1094,564,101.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="299" x2="566" y1="101.1094" y2="101.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="306" y="96.3672">Link with AccessToken + RefreshToken</text><polygon fill="#A80036" points="560,126.4199,570,130.4199,560,134.4199,564,130.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="566" y1="130.4199" y2="130.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="56" y="125.6777">Check Email</text><polygon fill="#A80036" points="60,155.7305,50,159.7305,60,163.7305,56,159.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="571" y1="159.7305" y2="159.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="66" y="154.9883">AccessToken + RefreshhToken</text><polygon fill="#A80036" points="287,185.041,297,189.041,287,193.041,291,189.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="293" y1="189.041" y2="189.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="56" y="184.2988">API Request + ?AccessToken</text><line style="stroke:#A80036;stroke-width:1.0;" x1="299" x2="341" y1="233.6621" y2="233.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="341" x2="341" y1="233.6621" y2="246.6621"/><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="341" y1="246.6621" y2="246.6621"/><polygon fill="#A80036" points="310,242.6621,300,246.6621,310,250.6621,306,246.6621" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="306" y="213.6094">Middleware validates AccessToken,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="310" y="228.9199">if valid, attaches userId to request</text><path d="M10,261.6621 L72,261.6621 L72,268.6621 L62,278.6621 L10,278.6621 L10,261.6621 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="282.6602" style="stroke:#000000;stroke-width:2.0;" width="329.5" x="10" y="261.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="275.2305">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="87" y="274.2969">[valid AccessToken]</text><polygon fill="#A80036" points="60,296.2832,50,300.2832,60,304.2832,56,300.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="298" y1="300.2832" y2="300.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="66" y="295.541">Handle request with userId</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="339.5" y1="309.2832" y2="309.2832"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99" x="15" y="319.918">[no AccessToken]</text><polygon fill="#A80036" points="60,355.8594,50,359.8594,60,363.8594,56,359.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="298" y1="359.8594" y2="359.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="66" y="339.8066">Handle request w/o userId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="70" y="355.1172">(may response 401 Unauthorized)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="339.5" y1="368.8594" y2="368.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="180" x="15" y="379.4941">[invalid signature AccessToken]</text><polygon fill="#A80036" points="60,400.125,50,404.125,60,408.125,56,404.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="298" y1="404.125" y2="404.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="66" y="399.3828">403 Forbidden</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="339.5" y1="413.125" y2="413.125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126" x="15" y="423.7598">[expired AccessToken]</text><polygon fill="#A80036" points="60,444.3906,50,448.3906,60,452.3906,56,448.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="298" y1="448.3906" y2="448.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="66" y="443.6484">401 Unauthorized (expired)</text><polygon fill="#A80036" points="287,473.7012,297,477.7012,287,481.7012,291,477.7012" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="293" y1="477.7012" y2="477.7012"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="56" y="472.959">GET /user/access w/ Refresh Token</text><polygon fill="#A80036" points="60,503.0117,50,507.0117,60,511.0117,56,507.0117" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="298" y1="507.0117" y2="507.0117"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="66" y="502.2695">New (AccessToken, RefreshToken)</text><polygon fill="#A80036" points="287,532.3223,297,536.3223,287,540.3223,291,536.3223" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="293" y1="536.3223" y2="536.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="56" y="531.5801">Retry original request</text><!--MD5=[b89d4276ce6be8196238691095a2e609]
@startuml general_auth_sequence
   participant Client as C
   participant Server as S
   participant "User's Email" as E

   C -> S: GET /user/login

   S -> E: Link with AccessToken + RefreshToken

   C -> E: Check Email

   E - -> C: AccessToken + RefreshhToken

   C -> S: API Request + ?AccessToken

   S -> S: Middleware validates AccessToken, \n if valid, attaches userId to request

   alt valid AccessToken

      S - -> C: Handle request with userId

   else no AccessToken

      S - -> C: Handle request w/o userId  \n (may response 401 Unauthorized)

   else invalid signature AccessToken

      S - -> C: 403 Forbidden

   else expired AccessToken

      S - -> C: 401 Unauthorized (expired)

      C -> S: GET /user/access w/ Refresh Token

      S - -> C: New (AccessToken, RefreshToken)

      C -> S: Retry original request

   end

@enduml

PlantUML version 1.2021.16(Wed Dec 08 12:25:22 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>