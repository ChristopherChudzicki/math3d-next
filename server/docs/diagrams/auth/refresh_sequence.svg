<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="357px" preserveAspectRatio="none" style="width:598px;height:357px;background:#FFFFFF;" version="1.1" viewBox="0 0 598 357" width="598px" zoomAndPan="magnify"><defs><filter height="300%" id="f1741nwybkkfbc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1741nwybkkfbc)" height="181.1738" style="stroke:#000000;stroke-width:2.0;" width="574.5" x="10" y="116.1094"/><rect fill="#FFFFFF" height="60.6211" style="stroke:none;stroke-width:1.0;" width="574.5" x="10" y="236.6621"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="49" x2="49" y1="40.4883" y2="314.2832"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="346.5" x2="346.5" y1="40.4883" y2="314.2832"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="533.5" x2="533.5" y1="40.4883" y2="314.2832"/><rect fill="#FEFECE" filter="url(#f1741nwybkkfbc)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="27" y="25.5352">Client</text><rect fill="#FEFECE" filter="url(#f1741nwybkkfbc)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="54" x="20" y="313.2832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="27" y="333.8184">Client</text><rect fill="#FEFECE" filter="url(#f1741nwybkkfbc)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="316.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="323.5" y="25.5352">Server</text><rect fill="#FEFECE" filter="url(#f1741nwybkkfbc)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="57" x="316.5" y="313.2832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="323.5" y="333.8184">Server</text><rect fill="#FEFECE" filter="url(#f1741nwybkkfbc)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="77" x="493.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="500.5" y="25.5352">Database</text><rect fill="#FEFECE" filter="url(#f1741nwybkkfbc)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="77" x="493.5" y="313.2832"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="500.5" y="333.8184">Database</text><polygon fill="#A80036" points="335,67.7988,345,71.7988,335,75.7988,339,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="341" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="56" y="67.0566">GET /user/access w/ RefreshToken</text><polygon fill="#A80036" points="522,97.1094,532,101.1094,522,105.1094,526,101.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="528" y1="101.1094" y2="101.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="354" y="96.3672">Check RefreshToken valid</text><path d="M10,116.1094 L72,116.1094 L72,123.1094 L62,133.1094 L10,133.1094 L10,116.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="181.1738" style="stroke:#000000;stroke-width:2.0;" width="574.5" x="10" y="116.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="129.6777">alt</text><polygon fill="#A80036" points="358,150.7305,348,154.7305,358,158.7305,354,154.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="352" x2="533" y1="154.7305" y2="154.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="364" y="149.9883">RefreshToken is valid</text><polygon fill="#A80036" points="522,195.3516,532,199.3516,522,203.3516,526,199.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="528" y1="199.3516" y2="199.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="354" y="179.2988">Delete old Refresh Token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="358" y="194.6094">Insert new RefreshToken</text><polygon fill="#A80036" points="60,224.6621,50,228.6621,60,232.6621,56,228.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="346" y1="228.6621" y2="228.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="66" y="223.9199">201: new (AccessToken, RefreshToken) pair</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="584.5" y1="237.6621" y2="237.6621"/><polygon fill="#A80036" points="358,255.9727,348,259.9727,358,263.9727,354,259.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="352" x2="533" y1="259.9727" y2="259.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="364" y="255.2305">Refresh token not valid</text><polygon fill="#A80036" points="60,285.2832,50,289.2832,60,293.2832,56,289.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="346" y1="289.2832" y2="289.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="66" y="284.541">403 Unauthorized</text><!--MD5=[a2ac09baad2633d4e36d1317aa923ae3]
@startuml refresh_sequence
   participant Client as C
   participant Server as S
   participant Database as Db

   C -> S: GET /user/access w/ RefreshToken

   S -> Db: Check RefreshToken valid

   alt

      Db - -> S: RefreshToken is valid

      S -> Db: Delete old Refresh Token \n Insert new RefreshToken

      S - -> C: 201: new (AccessToken, RefreshToken) pair

   else

      Db - -> S: Refresh token not valid

      S - -> C: 403 Unauthorized
   end
@enduml

PlantUML version 1.2021.16(Wed Dec 08 12:25:22 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>